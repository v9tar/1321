-- Ultimate Fruit Trade Controller v12.0
-- Ø¥ØµØ¯Ø§Ø± ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙˆØªØ­Ø³ÙŠÙ†Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©

local Player = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local TS = game:GetService("TweenService")
local RS = game:GetService("RunService")
local HS = game:GetService("HttpService")

--[[
    Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
]]
local function SecureFunction(func)
    return function(...)
        local args = {...}
        return pcall(function()
            return func(unpack(args))
        end)
    end
end

--[[
    Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©
]]
local GUI = Instance.new("ScreenGui")
GUI.Name = HS:GenerateGUID(false)
GUI.ResetOnSpawn = false
GUI.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TitleBar = Instance.new("Frame")
local TitleText = Instance.new("TextLabel")
local CloseBtn = Instance.new("TextButton")
local MinimizeBtn = Instance.new("TextButton")
local SettingsBtn = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")

-- ØªÙƒÙˆÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 320, 0, 280)
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -140)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.Parent = GUI

UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 32)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TitleBar.Parent = MainFrame

TitleText.Name = "TitleText"
TitleText.Text = " Ultimate Controller v12.0"
TitleText.TextColor3 = Color3.fromRGB(220, 220, 220)
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Size = UDim2.new(0.6, 0, 1, 0)
TitleText.Position = UDim2.new(0.05, 0, 0, 0)
TitleText.Font = Enum.Font.GothamMedium
TitleText.Parent = TitleBar

CloseBtn.Name = "CloseBtn"
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
CloseBtn.Size = UDim2.new(0, 32, 1, 0)
CloseBtn.Position = UDim2.new(1, -32, 0, 0)
CloseBtn.Parent = TitleBar

MinimizeBtn.Name = "MinimizeBtn"
MinimizeBtn.Text = "ğŸ——"
MinimizeBtn.Size = UDim2.new(0, 32, 1, 0)
MinimizeBtn.Position = UDim2.new(1, -64, 0, 0)
MinimizeBtn.Parent = TitleBar

SettingsBtn.Name = "SettingsBtn"
SettingsBtn.Text = "-"
SettingsBtn.Size = UDim2.new(0, 32, 1, 0)
SettingsBtn.Position = UDim2.new(1, -96, 0, 0)
SettingsBtn.Parent = TitleBar

-- Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -60)
ContentFrame.Position = UDim2.new(0, 10, 0, 50)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

--[[
    Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
]]
local PlayerBox = Instance.new("TextBox")
local ControlBtn = Instance.new("TextButton")
local JumpToggle = Instance.new("TextButton")
local SelfJumpToggle = Instance.new("TextButton")
local AcceptForMeBtn = Instance.new("TextButton")
local AcceptForHimBtn = Instance.new("TextButton")

PlayerBox.Name = "PlayerBox"
PlayerBox.PlaceholderText = "Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (2+ Ø£Ø­Ø±Ù)"
PlayerBox.Size = UDim2.new(1, 0, 0, 30)
PlayerBox.Position = UDim2.new(0, 0, 0, 10)
PlayerBox.Parent = ContentFrame

ControlBtn.Name = "ControlBtn"
ControlBtn.Text = "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­ÙƒÙ…"
ControlBtn.Size = UDim2.new(1, 0, 0, 35)
ControlBtn.Position = UDim2.new(0, 0, 0, 50)
ControlBtn.Parent = ContentFrame

JumpToggle.Name = "JumpToggle"
JumpToggle.Text = "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙØ² (Ù„Ù‡)"
JumpToggle.Size = UDim2.new(0.48, 0, 0, 35)
JumpToggle.Position = UDim2.new(0, 0, 0, 95)
JumpToggle.Parent = ContentFrame

SelfJumpToggle.Name = "SelfJumpToggle"
SelfJumpToggle.Text = "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙØ² (Ù„ÙŠ)"
SelfJumpToggle.Size = UDim2.new(0.48, 0, 0, 35)
SelfJumpToggle.Position = UDim2.new(0.52, 0, 0, 95)
SelfJumpToggle.Parent = ContentFrame

AcceptForMeBtn.Name = "AcceptForMeBtn"
AcceptForMeBtn.Text = "Ù‚Ø¨ÙˆÙ„ Ù„ÙŠ"
AcceptForMeBtn.Size = UDim2.new(0.48, 0, 0, 35)
AcceptForMeBtn.Position = UDim2.new(0, 0, 0, 140)
AcceptForMeBtn.Parent = ContentFrame

AcceptForHimBtn.Name = "AcceptForHimBtn"
AcceptForHimBtn.Text = "Ù‚Ø¨ÙˆÙ„ Ù„Ù‡"
AcceptForHimBtn.Size = UDim2.new(0.48, 0, 0, 35)
AcceptForHimBtn.Position = UDim2.new(0.52, 0, 0, 140)
AcceptForHimBtn.Parent = ContentFrame

--[[
    Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
]]
local ControlledPlayer = nil
local OriginalSettings = {}
local Debounce = false

local function FindPlayer(name)
    -- Ù†Ø¸Ø§Ù… Ø¨Ø­Ø« Ù…ØªØ·ÙˆØ± Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©
    local closestPlayer = nil
    local lowestDifference = math.huge
    
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        if player ~= Player then
            local playerName = player.Name:lower()
            local inputName = name:lower():gsub("[%c%z]", ""):sub(1, 20)
            
            -- Ø­Ø³Ø§Ø¨ ØªØ´Ø§Ø¨Ù‡ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡
            local difference = math.abs(playerName:len() - inputName:len())
            
            if playerName:find(inputName) then
                if difference < lowestDifference then
                    closestPlayer = player
                    lowestDifference = difference
                end
            end
        end
    end
    return closestPlayer
end

local ControlSystem = {
    ToggleJump = SecureFunction(function(target, state)
        if target and target.Character then
            local humanoid = target.Character:FindFirstChild("Humanoid")
            if humanoid then
                OriginalSettings[target] = OriginalSettings[target] or {
                    JumpPower = humanoid.JumpPower,
                    WalkSpeed = humanoid.WalkSpeed
                }
                humanoid.JumpPower = state and 0 or OriginalSettings[target].JumpPower
            end
        end
    end),
    
    ForceAcceptForMe = SecureFunction(function()
        for _, button in pairs(game:GetService("GuiService"):GetGuiObjects()) do
            if button:IsA("TextButton") and (button.Text:lower():find("accept") or button.Text:lower():find("confirm")) then
                button:FireEvent("MouseButton1Click")
            end
        end
    end),
    
    ForceAcceptForHim = SecureFunction(function()
        if ControlledPlayer then
            -- Ù†Ø¸Ø§Ù… Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¢Ø®Ø±
            pcall(function()
                game:GetService("ReplicatedStorage").Trade.Accept:FireServer(true)
            end)
        end
    end)
}

--[[
    Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
]]
local Dragging = false
local DragStartPosition = nil
local FrameStartPosition = nil

local function IsEmptySpace(mousePos)
    local framePos = MainFrame.AbsolutePosition
    local frameSize = MainFrame.AbsoluteSize
    
    -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù‚Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø±
    if not (mousePos.X >= framePos.X and mousePos.X <= framePos.X + frameSize.X and
           mousePos.Y >= framePos.Y and mousePos.Y <= framePos.Y + frameSize.Y) then
        return false
    end
    
    -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ù†ØµØ± ØªÙØ§Ø¹Ù„ÙŠ
    for _, child in ipairs(MainFrame:GetDescendants()) do
        if child:IsA("GuiButton") or child:IsA("TextBox") then
            local childPos = child.AbsolutePosition
            local childSize = child.AbsoluteSize
            
            if mousePos.X >= childPos.X and mousePos.X <= childPos.X + childSize.X and
               mousePos.Y >= childPos.Y and mousePos.Y <= childPos.Y + childSize.Y then
                return false
            end
        end
    end
    return true
end

UIS.InputBegan:Connect(function(input)
    if (input.UserInputType == Enum.UserInputType.MouseButton1 or 
       input.UserInputType == Enum.UserInputType.Touch) and IsEmptySpace(input.Position) then
        
        Dragging = true
        DragStartPosition = input.Position
        FrameStartPosition = MainFrame.Position
        
        -- Ù†Ø¸Ø§Ù… ØªØ­Ø±ÙŠÙƒ Ø³Ù„Ø³
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                Dragging = false
                connection:Disconnect()
            end
        end)
    end
end)

UIS.InputChanged:Connect(function(input)
    if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - DragStartPosition
        MainFrame.Position = UDim2.new(
            FrameStartPosition.X.Scale,
            FrameStartPosition.X.Offset + delta.X,
            FrameStartPosition.Y.Scale,
            FrameStartPosition.Y.Offset + delta.Y
        )
    end
end)

--[[
    ØªÙˆØµÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
]]
ControlBtn.MouseButton1Click:Connect(function()
    local inputName = PlayerBox.Text:gsub("[%c%z]", ""):sub(1, 20)
    if inputName:len() < 2 then
        warn("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„è‡³å°‘ Ø­Ø±ÙÙŠÙ†")
        return
    end
    
    local target = FindPlayer(inputName)
    if target then
        ControlledPlayer = target
        ControlBtn.Text = "Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ: " .. target.Name
        PlayerBox.Text = target.Name
    else
        warn("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù„Ø§Ø¹Ø¨")
    end
end)

JumpToggle.MouseButton1Click:Connect(function()
    if ControlledPlayer then
        local newState = JumpToggle.Text == "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙØ² (Ù„Ù‡)"
        ControlSystem.ToggleJump(ControlledPlayer, newState)
        JumpToggle.Text = newState and "ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù‚ÙØ² (Ù„Ù‡)" or "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙØ² (Ù„Ù‡)"
    end
end)

SelfJumpToggle.MouseButton1Click:Connect(function()
    local newState = SelfJumpToggle.Text == "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙØ² (Ù„ÙŠ)"
    ControlSystem.ToggleJump(Player, newState)
    SelfJumpToggle.Text = newState and "ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù‚ÙØ² (Ù„ÙŠ)" or "ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù‚ÙØ² (Ù„ÙŠ)"
end)

AcceptForMeBtn.MouseButton1Click:Connect(function()
    ControlSystem.ForceAcceptForMe()
end)

AcceptForHimBtn.MouseButton1Click:Connect(function()
    ControlSystem.ForceAcceptForHim()
end)

CloseBtn.MouseButton1Click:Connect(function()
    GUI:Destroy()
end)

MinimizeBtn.MouseButton1Click:Connect(function()
    ContentFrame.Visible = not ContentFrame.Visible
    local targetSize = ContentFrame.Visible and UDim2.new(0, 320, 0, 280) or UDim2.new(0, 320, 0, 32)
    
    TS:Create(MainFrame, TweenInfo.new(0.3), {Size = targetSize}):Play()
end)

-- Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ø­Ø°Ù
RS.Heartbeat:Connect(function()
    if not GUI or not GUI.Parent then
        GUI = GUI:Clone()
        GUI.Parent = game:GetService("CoreGui")
    end
end)

warn("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø³ÙƒØ±Ø¨Øª Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù†Ø¬Ø§Ø­! | Ultimate Controller v12.0")
