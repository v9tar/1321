-- Ultimate Fruit Trade Controller v17.0 FINAL
-- Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª

local Player = game:GetService("Players").LocalPlayer
local UIS = game:GetService("UserInputService")
local TS = game:GetService("TweenService")
local RS = game:GetService("RunService")
local HS = game:GetService("HttpService")

--[[ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ]]
local function SecureFunction(func)
    return function(...)
        local args = {...}
        local success, result = pcall(func, unpack(args))
        if not success then
            warn("Ø­Ø¯Ø« Ø®Ø·Ø£:", result)
        end
        return success, result
    end
end

--[[ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ]]
local GUI = Instance.new("ScreenGui")
GUI.Name = "TradeControl_"..HS:GenerateGUID(false)
GUI.ResetOnSpawn = false
GUI.Parent = game:GetService("CoreGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 250)
MainFrame.Position = UDim2.new(1, -310, 0.5, -125) -- Ø§Ù„Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø£ÙŠÙ…Ù†
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.Active = true
MainFrame.Parent = GUI

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TitleBar.Parent = MainFrame

local TitleText = Instance.new("TextLabel")
TitleText.Text = " Ultimate Controller v17.0"
TitleText.TextColor3 = Color3.fromRGB(200, 200, 200)
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Size = UDim2.new(0.7, 0, 1, 0)
TitleText.Position = UDim2.new(0.05, 0, 0, 0)
TitleText.Font = Enum.Font.GothamBold
TitleText.Parent = TitleBar

-- Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 40)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
local PlayerBox = Instance.new("TextBox")
PlayerBox.PlaceholderText = "Ø§Ø³Ù… Ø§Ù„Ù„Ù€Ø§Ø¹Ù€Ø¨ (3+ Ø£Ø­Ø±Ù)"
PlayerBox.Size = UDim2.new(1, 0, 0, 30)
PlayerBox.Position = UDim2.new(0, 0, 0, 10)
PlayerBox.ClearTextOnFocus = false
PlayerBox.Parent = ContentFrame

local ControlBtn = Instance.new("TextButton")
ControlBtn.Text = "Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­ÙƒÙ…"
ControlBtn.Size = UDim2.new(1, 0, 0, 35)
ControlBtn.Position = UDim2.new(0, 0, 0, 50)
ControlBtn.Parent = ContentFrame

local JumpToggleHim = Instance.new("TextButton")
JumpToggleHim.Text = "ØªØ¹Ø·ÙŠÙ„ Ù‚ÙØ²Ù‡ ğŸ”’"
JumpToggleHim.Size = UDim2.new(0.48, 0, 0, 35)
JumpToggleHim.Position = UDim2.new(0, 0, 0, 95)
JumpToggleHim.Parent = ContentFrame

local JumpToggleMe = Instance.new("TextButton")
JumpToggleMe.Text = "ØªØ¹Ø·ÙŠÙ„ Ù‚ÙØ²ÙŠ ğŸ”“"
JumpToggleMe.Size = UDim2.new(0.48, 0, 0, 35)
JumpToggleMe.Position = UDim2.new(0.52, 0, 0, 95)
JumpToggleMe.Parent = ContentFrame

local AcceptHimBtn = Instance.new("TextButton")
AcceptHimBtn.Text = "Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„ âœ…"
AcceptHimBtn.Size = UDim2.new(1, 0, 0, 35)
AcceptHimBtn.Position = UDim2.new(0, 0, 0, 140)
AcceptHimBtn.Parent = ContentFrame

--[[ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ]]
local ControlledPlayer = nil
local Debounce = false

local function FindPlayer(name)
    name = name:lower():gsub("[^%w]", ""):sub(1, 20)
    if #name < 3 then return nil end
    
    local closestPlayer, minDiff = nil, math.huge
    
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        if player ~= Player then
            local playerName = player.Name:lower():gsub("[^%w]", "")
            if playerName:find(name) then
                local diff = math.abs(#playerName - #name)
                if diff < minDiff then
                    closestPlayer = player
                    minDiff = diff
                end
            end
        end
    end
    
    return closestPlayer
end

local ControlSystem = {
    ToggleJump = SecureFunction(function(target, state)
        if not target or not target.Character then return false end
        
        local humanoid = target.Character:FindFirstChildOfClass("Humanoid")
        if not humanoid then return false end
        
        if state then
            humanoid:SetAttribute("OriginalJump", humanoid.JumpPower)
            humanoid.JumpPower = 0
        else
            humanoid.JumpPower = humanoid:GetAttribute("OriginalJump") or 50
        end
        
        return true
    end),
    
    ForceAcceptHim = SecureFunction(function()
        if not ControlledPlayer then return false end
        
        -- Ù†Ø¸Ø§Ù… Ù…ØªÙ‚Ø¯Ù… Ù„Ù„Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
        local success = false
        for _, remote in pairs(game:GetService("ReplicatedStorage"):GetDescendants()) do
            if remote:IsA("RemoteEvent") and remote.Name:lower():find("accept") then
                fireclickdetector(remote)
                remote:FireServer(true)
                success = true
            end
        end
        return success
    end)
}

--[[ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ]]
local dragging = false
local dragStart = Vector2.new()
local frameStart = Vector2.new()

local function IsEmptySpace(mousePos)
    local absPos = MainFrame.AbsolutePosition
    local absSize = MainFrame.AbsoluteSize
    
    if mousePos.X < absPos.X or mousePos.X > absPos.X + absSize.X then return false end
    if mousePos.Y < absPos.Y or mousePos.Y > absPos.Y + absSize.Y then return false end
    
    for _, child in ipairs(MainFrame:GetDescendants()) do
        if child:IsA("GuiButton") or child:IsA("TextBox") then
            local cPos = child.AbsolutePosition
            local cSize = child.AbsoluteSize
            if mousePos.X >= cPos.X and mousePos.X <= cPos.X + cSize.X and
               mousePos.Y >= cPos.Y and mousePos.Y <= cPos.Y + cSize.Y then
                return false
            end
        end
    end
    
    return true
end

UIS.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        if IsEmptySpace(input.Position) then
            dragging = true
            dragStart = Vector2.new(input.Position.X, input.Position.Y)
            frameStart = Vector2.new(MainFrame.Position.X.Offset, MainFrame.Position.Y.Offset)
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end
end)

UIS.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - dragStart
        MainFrame.Position = UDim2.new(0, frameStart.X + delta.X, 0, frameStart.Y + delta.Y)
    end
end)

--[[ ØªÙˆØµÙŠÙ„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ]]
ControlBtn.MouseButton1Click:Connect(function()
    if Debounce then return end
    Debounce = true
    
    local target = FindPlayer(PlayerBox.Text)
    if target then
        ControlledPlayer = target
        PlayerBox.Text = target.Name
        ControlBtn.Text = "Ø§Ù„ØªØ­ÙƒÙ…: "..target.Name
        warn("ØªÙ… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ: "..target.Name)
    else
        warn("Ø§Ù„Ù„Ø§Ø¹Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!")
    end
    
    Debounce = false
end)

JumpToggleHim.MouseButton1Click:Connect(function()
    if not ControlledPlayer then return end
    
    local newState = JumpToggleHim.Text:find("ğŸ”’")
    local success = ControlSystem.ToggleJump(ControlledPlayer, newState)
    
    if success then
        JumpToggleHim.Text = newState and "ØªÙ…ÙƒÙŠÙ† Ù‚ÙØ²Ù‡ ğŸ”“" or "ØªØ¹Ø·ÙŠÙ„ Ù‚ÙØ²Ù‡ ğŸ”’"
    else
        warn("ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‚ÙØ² Ø§Ù„Ù„Ø§Ø¹Ø¨!")
    end
end)

JumpToggleMe.MouseButton1Click:Connect(function()
    local newState = JumpToggleMe.Text:find("ğŸ”’")
    local success = ControlSystem.ToggleJump(Player, newState)
    
    if success then
        JumpToggleMe.Text = newState and "ØªÙ…ÙƒÙŠÙ† Ù‚ÙØ²ÙŠ ğŸ”“" or "ØªØ¹Ø·ÙŠÙ„ Ù‚ÙØ²ÙŠ ğŸ”’"
    else
        warn("ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‚ÙØ²Ùƒ!")
    end
end)

AcceptHimBtn.MouseButton1Click:Connect(function()
    local success = ControlSystem.ForceAcceptHim()
    if success then
        warn("ØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø¨ÙˆÙ„!")
    else
        warn("ÙØ´Ù„ ÙÙŠ Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù‚Ø¨ÙˆÙ„!")
    end
end)

-- Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„Ø­Ø°Ù
RS.Heartbeat:Connect(function()
    if not GUI or not GUI.Parent then
        GUI = GUI:Clone()
        GUI.Parent = game:GetService("CoreGui")
    end
end)

warn("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø¨Ù†Ø¬Ø§Ø­! ğŸš€")
